import{U as j,A as l,_ as Q,q as T,l as D,Q as g}from"./mockInPageEdit.dGXzNdjP.js";import{n as E}from"./Preferences-DS4-CFWe.DlUhv_7c.js";import{c as O}from"./makeCallable-LDU0xZMJ.BgixzwPG.js";import"./framework.DeVdP8gD.js";var S=Object.create,m=Object.defineProperty,C=Object.getOwnPropertyDescriptor,x=(t,i)=>(i=Symbol[t])?i:Symbol.for("Symbol."+t),f=t=>{throw TypeError(t)},F=(t,i,r)=>i in t?m(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,N=(t,i)=>m(t,"name",{value:i,configurable:!0}),z=t=>[,,,S(t?.[x("metadata")]??null)],B=["class","method","getter","setter","accessor","field","value","get","set"],b=t=>t!==void 0&&typeof t!="function"?f("Function expected"):t,_=(t,i,r,a,e)=>({kind:B[t],name:i,metadata:a,addInitializer:n=>r._?f("Already initialized"):e.push(b(n||null))}),A=(t,i)=>F(i,x("metadata"),t[3]),I=(t,i,r,a)=>{for(var e=0,n=t[i>>1],o=n&&n.length;e<o;e++)n[e].call(r);return a},W=(t,i,r,a,e,n)=>{var o,c,d,s=i&7,h=!1,v=0,q=t[v]||(t[v]=[]),u=s&&(e=e.prototype,s<5&&(s>3||!h)&&C(e,r));N(e,r);for(var p=a.length-1;p>=0;p--)d=_(s,r,c={},t[3],q),o=(0,a[p])(e,d),c._=1,b(o)&&(e=o);return A(t,e),u&&m(e,r,u),h?s^4?n:u:e},P,k,y;P=[D(["api","wikiPage","modal","preferences"]),E(g.object({"quickPreview.keyshortcut":g.string().default("ctrl-p").description("Key shortcut to open quick preview in quick edit modal")}).extra("category","edit").description("Quick preview options"))];class w extends(y=j){constructor(i){super(i,{},"quickPreview"),this.ctx=i,this.ctx.set("quickPreview",O(this,"previewWikitext"))}start(){this.ctx.on("quick-edit/wiki-page",this.injectQuickEdit.bind(this)),this.ctx.on("quick-delete/wiki-page",this.injectQuickDelete.bind(this))}stop(){}previewWikitext(i,r,a,e,n){return a||=this.ctx.wikiPage.newBlankPage({title:"API"}),(!e||e.isDestroyed)&&(e=this.ctx.modal.createObject({className:"in-page-edit ipe-quickPreview",sizeClass:"large",center:!1,...n}).init()),e.show(),e.setTitle("Preview - Loading..."),e.setContent(l(T,{})),e.bringToFront(),this.ctx.emit("quick-preview/show-modal",{ctx:this.ctx,text:i,modal:e,wikiPage:a}),a.preview(i,r).then(o=>{const{data:{parse:c}}=o;e.setTitle(`Preview - ${c.title}`);let d=null;e.setContent(l("section",{children:l("div",{ref:s=>d=s,className:"mw-parser-output",innerHTML:c.text})})),window.mw?.hook("wikipage.content").fire($(d)),this.ctx.emit("quick-preview/loaded",{ctx:this.ctx,modal:e,wikiPage:a,text:i,parseData:c})}).catch(o=>{e.setTitle("Preview - Failed"),e.setContent(l(Q,{children:[l("p",{children:"Failed to preview"}),l("p",{children:o instanceof Error?o.message:String(o)})]}))}),e}async injectQuickEdit({options:i,modal:r,wikiPage:a}){let e;r.addButton({label:"Preview",side:"left",className:"btn btn-secondary",keyPress:await this.ctx.preferences.get("quickPreview.keyshortcut.quickEdit")||void 0,method:()=>{let n=r.get$content().querySelector('textarea[name="text"]')?.value||"";if(i.section==="new"){const o=r.get$content().querySelector('input[name="summary"]')?.value;o&&(n=`==${o}==
${n}`)}e=this.previewWikitext(n,void 0,a,e,{backdrop:!1,draggable:!0})}},1),r.on(r.Event.Close,()=>{e?.destroy(),e=void 0})}injectQuickDelete({ctx:i,modal:r,wikiPage:a}){r.addButton({label:"Preview",side:"left",className:"btn btn-secondary",method:()=>{this.logger.warn("To be implemented: preview wikitext for quick delete")}},2)}}k=z(y);w=W(k,0,"PluginQuickPreview",P,w);I(k,1,w);export{w as PluginQuickPreview};
