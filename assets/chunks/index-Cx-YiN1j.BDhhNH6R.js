import{U as d,A as e,q as m}from"./mockInPageEdit.dGXzNdjP.js";import{M as h}from"./index-Bh70Udzi.Dbb3Yksk.js";import{b as u}from"./InputBox-BV4m05Xs.CAsaNFkw.js";import{h as g}from"./CheckBox-D3rHnX7I.1sNjju7J.js";import"./framework.DeVdP8gD.js";const s=class s extends d{constructor(t){super(t,{},"quick-redirect"),this.ctx=t}start(){this.ctx.set("quickRedirect",this.quickRedirect.bind(this)),this.ctx.set("redirectPage",this.redirectPage.bind(this));const t=window.mw?.config.get("wgPageName")||"",i=window.mw?.config.get("wgIsProbablyEditable");this.ctx.inject(["toolbox"],r=>{this.ctx=r,r.toolbox.addButton({id:"quick-redirect",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon icon-tabler icons-tabler-outline icon-tabler-file-symlink",children:[e("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M4 21v-4a3 3 0 0 1 3 -3h5"}),e("path",{d:"M9 17l3 -3l-3 -3"}),e("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"}),e("path",{d:"M5 11v-6a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-9.5"})]}),tooltip:"Quick Redirect",group:"group1",index:2,onClick:()=>{this.quickRedirect(i?{to:t}:{})}}),this.addDisposeHandler(o=>{o.toolbox.removeButton("quick-redirect")})})}stop(){}quickRedirect(t){const i=this.ctx.modal.createObject({title:"Quick Redirect",content:e(m,{}),className:"quick-redirect compact-buttons",sizeClass:"smallToMedium",center:!0}).init();let r=null;return i.setContent(e("form",{ref:o=>r=o,style:{display:"flex",flexDirection:"column",gap:"1rem"},onSubmit:o=>{if(o.preventDefault(),r?.checkValidity(),!r?.reportValidity())return;const n=new FormData(r),c={from:n.get("from")?.toString().trim(),to:n.get("to")?.toString().trim(),reason:n.get("reason")||"",overwrite:n.get("overwrite")==="on"};if(!c.from||!c.to){this.ctx.modal.notify("error",{title:"Failed to redirect",content:"From and to are required."});return}i.setLoadingState(!0),this.redirectPage(c).then(a=>{i.close(),this.ctx.modal.notify("success",{title:"Redirect successful",content:"The redirect has been created."})}).catch(a=>{i.setLoadingState(!1),this.ctx.modal.notify("error",{title:"Failed to redirect",content:a instanceof Error?a.message:String(a)})})},children:[e(h,{inputs:[{label:"From",name:"from",value:t?.from,required:!0},{label:"To",name:"to",value:t?.to,required:!0}]}),e(u,{label:"Reason",id:"reason",name:"reason",value:t?.reason}),e("div",{children:e(g,{name:"overwrite",id:"overwrite",checked:t?.overwrite,children:"Force create redirect even if the from page already exists"})})]})),i.setButtons([{label:"Create Redirect",className:"is-primary is-ghost",method:()=>{r?.dispatchEvent(new Event("submit"))}}]),i.show()}async redirectPage(t){const{from:i,to:r,reason:o="",overwrite:n=!1}=t,c=await this.ctx.wikiPage.newBlankPage({title:i}),a=`#REDIRECT [[:${r}]]`;return c.edit({text:a,summary:o},{createonly:!n})}};s.inject=["api","wikiPage","modal"];let l=s;export{l as PluginQuickRedirect};
