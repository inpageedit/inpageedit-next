import{h as q,A as a,l as A,Q as f}from"./mockInPageEdit.dGXzNdjP.js";import{n as D}from"./Preferences-DS4-CFWe.DlUhv_7c.js";import"./framework.DeVdP8gD.js";var C=Object.create,x=Object.defineProperty,T=Object.getOwnPropertyDescriptor,v=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),w=e=>{throw TypeError(e)},E=(e,t,o)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,k=(e,t)=>x(e,"name",{value:t,configurable:!0}),M=e=>[,,,C(e?.[v("metadata")]??null)],O=["class","method","getter","setter","accessor","field","value","get","set"],S=e=>e!==void 0&&typeof e!="function"?w("Function expected"):e,j=(e,t,o,i,n)=>({kind:O[e],name:t,metadata:i,addInitializer:r=>o._?w("Already initialized"):n.push(S(r||null))}),z=(e,t)=>E(t,v("metadata"),e[3]),_=(e,t,o,i)=>{for(var n=0,r=e[t>>1],c=r&&r.length;n<c;n++)r[n].call(o);return i},H=(e,t,o,i,n,r)=>{var c,b,g,l=t&7,p=!1,s=0,u=e[s]||(e[s]=[]),h=l&&(n=n.prototype,l<5&&(l>3||!p)&&T(n,o));k(n,o);for(var d=i.length-1;d>=0;d--)g=j(l,o,b={},e[3],u),c=(0,i[d])(n,g),b._=1,S(c)&&(n=c);return z(e,n),h&&x(n,o,h),p?l^4?r:h:n},B,m,L;B=[D(f.object({toolboxAlwaysShow:f.boolean().description("Make the toolbox opened by default").default(!1)}).description("Toolbox preferences")),A(["preferences"])];class y extends(L=q){constructor(t){super(t,"toolbox",!1),this.ctx=t,this.container=void 0}async start(){this.container=this.createToolbox(),this.ctx.preferences.get("toolboxAlwaysShow").then(t=>{t&&this.container.classList.add("is-persistent")}),this.setupHoverLogic(),document.body.appendChild(this.container),this.updateButtonDelays()}stop(){this.container?.remove()}get isPersistent(){return this.container.classList.contains("is-persistent")}setupHoverLogic(){let t=null;this.container.addEventListener("mouseenter",()=>{t&&(clearTimeout(t),t=null),this.isPersistent||this.container.classList.add("is-hovered")}),this.container.addEventListener("mouseleave",()=>{this.isPersistent||(t=window.setTimeout(()=>{this.container.classList.remove("is-hovered")},150))})}calculateButtonDelay(t,o){if(o<=1)return 0;const i=.15,n=t/(o-1),r=i*Math.sqrt(n);return Math.round(r*1e3)/1e3}updateButtonDelays(){this.container.querySelectorAll(".btn-group").forEach(t=>{const o=t.querySelectorAll(".btn-tip-group"),i=o.length;o.forEach((n,r)=>{const c=this.calculateButtonDelay(r,i);n.style.setProperty("--transition-delay",`${c}s`),n.style.setProperty("--max-transition-delay","0.15s")})})}createToolbox(){return a("div",{id:"ipe-edit-toolbox",children:[a("ul",{className:"btn-group group1",style:{display:"flex",flexDirection:"column"}}),a("ul",{className:"btn-group group2",style:{display:"flex",flexDirection:"row"}}),a("button",{className:"ipe-toolbox-btn",id:"toolbox-toggler",onClick:()=>{this.toggle()},children:a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"448",height:"512",viewBox:"0 0 448 512",children:[a("rect",{width:"448",height:"512",fill:"none"}),a("path",{fill:"currentColor",d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32"})]})})]})}normalizeButtonId(t){return t||(t=Math.random().toString(36).substring(2,8)),`ipe-toolbox__${t.trim()}`.replace(/\s\.#/g,"-")}addButton(t){let{id:o,group:i,icon:n,tooltip:r,itemProps:c,buttonProps:b,onClick:g,index:l}=t;o=this.normalizeButtonId(o);const p=this.container.querySelector(`#${o}`);p&&(this.ctx.logger("toolbox").warn(`Button with id ${o} already exists, replacing it.`),p.remove());let s=null;if(typeof i>"u"||i==="auto"){const h=this.container.querySelector(".btn-group.group1"),d=this.container.querySelector(".btn-group.group2"),P=h?.children.length||0,$=d?.children.length||0;s=P<=$?h:d}else s=this.container.querySelector(`.btn-group.${i}`);if(!s)throw new Error(`Button group ${i} not found`);const u=a("li",{class:"btn-tip-group",id:o,onClick:g,...c,children:[a("div",{class:"btn-tip",children:r}),a("button",{id:`${o}-btn`,class:"ipe-toolbox-btn",...b,children:n})]});return typeof l=="number"?l<=0?s.prepend(u):l>=s.children.length?s.appendChild(u):s.children[l]?.before(u):s.appendChild(u),this.ctx.emit("toolbox/button-added",{ctx:this.ctx,button:u}),this.updateButtonDelays(),u}removeButton(t){this.container.querySelector(`.ipe-toolbox-btn#${t}`)?.remove(),this.ctx.emit("toolbox/button-removed",{ctx:this.ctx,id:t}),this.updateButtonDelays()}getContainer(){return this.container}get isOpened(){return this.container.classList.contains("is-persistent")||this.container.classList.contains("is-hovered")}toggle(t){const o=this.isPersistent,i=typeof t=="boolean"?t:!o;this.container.classList.toggle("is-persistent",i),this.container.classList.remove("is-hovered"),this.ctx.preferences.set("toolboxAlwaysShow",i)}}m=M(L);y=H(m,0,"PluginToolbox",B,y);_(m,1,y);export{y as PluginToolbox};
