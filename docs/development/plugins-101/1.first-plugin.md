# ç¬¬ä¸€ä¸ªæ’ä»¶

## è®¤è¯†æ’ä»¶ï¼šå‡½æ•°å¼æ’ä»¶

**æœ€ç®€å•çš„ IPE çš„æ’ä»¶ï¼Œå°±æ˜¯ä¸€ä¸ªæŽ¥å—ä¾èµ–æ³¨å…¥çš„æ™®é€šå‡½æ•°ã€‚**

```js twoslash
/**
 * æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ’ä»¶ï¼
 * @param {import('@inpageedit/core').InPageEdit} ctx - æ’ä»¶æ‰€å±žçš„ä¸Šä¸‹æ–‡
 * @param {any} [config] - å¯èƒ½ä¼ å…¥çš„é…ç½®é¡¹
 */
function myPlugin(ctx, config) {
  console.log(ctx, `hello, ${config.name || 'world'}`) // hello, IPE
}
// ç„¶åŽåŠ è½½å®ƒ
ipe.plugin(myPlugin, { name: 'IPE' })
```

ä½ æ²¡çœ‹é”™ï¼Œå°±è¿™ä¹ˆä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œä¾¿æ˜¯åˆæ³•çš„ IPE æ’ä»¶ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•° `ctx` æ˜¯æ’ä»¶æ‰€å±žçš„ä¸Šä¸‹æ–‡ï¼Œä½ ä¹Ÿå¯ä»¥æŽ¥å—ç¬¬äºŒä¸ªå‚æ•° `config`ï¼Œå®ƒæ˜¯å¯èƒ½ä¼ å…¥çš„é…ç½®é¡¹ã€‚

::: tip

å¯¹äºŽç®€å•çš„æ’ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬æ›´æŽ¨èç›´æŽ¥ä¼ å…¥ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œé™¤äº†äº†æ›´ç®€æ´ä¹‹å¤–ï¼Œè¿˜èƒ½è‡ªåŠ¨èŽ·å¾—å…³äºŽ `ctx` çš„ç±»åž‹æŽ¨å¯¼ï¼

:::

```ts twoslash
ipe.plugin((ctx) => {
  console.log(ctx, 'hello, world')
  //          ^?
})
```

ä½ å¯ä»¥äº²è‡ªå°è¯•ä¸€ä¸‹ï¼šæ‰“å¼€ä½ çš„æµè§ˆå™¨æŽ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œç²˜è´´ä¸Šé¢çš„ä»£ç ï¼ŒæŒ‰ä¸‹å›žè½¦é”®ã€‚

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå½“ä½ åŠ è½½è¿™ä¸ªæ’ä»¶åŽï¼Œç«‹åˆ»å°±èƒ½åœ¨æŽ§åˆ¶å°çœ‹åˆ° `hello, world` å­—æ ·ã€‚

## è®©æˆ‘ä»¬åšäº›ä»€ä¹ˆ

ä¸ºäº†æ›´å¥½çš„ç†è§£ IPE çš„æ’ä»¶æœºåˆ¶ï¼Œæˆ‘ä»¬è®©è¿™ä¸ªæ’ä»¶åšç‚¹äº‹æƒ…ï¼š

```ts twoslash
ipe.plugin((ctx) => {
  ctx.toolbox.addButton({
    id: 'my-first-plugin',
    icon: 'ðŸ‘‹',
    tooltip: 'My First Plugin',
    onClick: () => {
      alert('hello, world')
    },
  })
})
```

çœ‹çœ‹é¡µé¢å³ä¸‹è§’çš„å·¥å…·ç›’ï¼Œæ˜¯ä¸æ˜¯å¤šäº†ä¸€ä¸ªæŒ‰é’®ï¼Ÿç‚¹å‡»å®ƒï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªå¼¹çª—ï¼Œä¸Šé¢å†™ç€ `hello, world`ã€‚

çœŸä¸èµ–ï¼Œæˆ‘ä»¬çš„æ’ä»¶çœ‹ä¸ŠåŽ»ç¦»â€œå¿«é€Ÿç¼–è¾‘â€ä¹Ÿä¸è¿œå˜›ï¼

ä½†æ˜¯æŽ§åˆ¶å°ä¸­æœ‰ä¸€äº›è­¦å‘Šï¼š

> Error: property toolbox is not registered, declare it as `inject` to suppress this warning

åˆ«ç´§å¼ ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨æ’ä»¶ä¸­æ³¨å…¥ `toolbox` æœåŠ¡ã€‚

## ä¾èµ–æ³¨å…¥

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ’ä»¶ä¸­æ³¨å…¥ `toolbox` æœåŠ¡ã€‚

```ts twoslash
ipe.plugin((ctx) => {
  // [!code ++]
  ctx.inject(['toolbox'], (ctx) => {
    //^^^^^^
    ctx.toolbox.addButton({
      id: 'my-first-plugin',
      icon: 'ðŸ‘‹',
      tooltip: 'My First Plugin',
      onClick: () => {
        alert('hello, world')
      },
    })
  }) // [!code ++]
})
```

çŽ°åœ¨æ²¡æœ‰æŠ¥é”™äº†ï¼ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ

å› ä¸º `ctx.toolbox` å…¶å®žæ˜¯ç”±å¦å¤–ä¸€ä¸ªæ’ä»¶æä¾›çš„æœåŠ¡ï¼Œå®ƒçš„åŠ è½½æ—¶æœºæ˜¯ä¸ç¡®å®šçš„ã€‚äººæ€»æœ‰è¿æ°”å·®çš„æ—¶å€™ï¼Œä¸‡ä¸€å’±ä»¬çš„`myButtonPlugin`å®‰è£…æ—¶`toolbox`è¿˜æ²¡æœ‰åŠ è½½ï¼Œé‚£ä½ å°±åªèƒ½æœ› `undefined` è€Œå…´å¹äº†ã€‚

è€Œé€šè¿‡ `ctx.inject`ï¼ŒIPEä¼šç¡®ä¿ä½ åœ¨æ’ä»¶ä¸­æ‹¿åˆ°çš„ä¸Šä¸‹æ–‡ï¼Œä¸€å®šåŒ…å«äº† `toolbox` æœåŠ¡ã€‚

## æ›´æ¸…æ™°çš„å®šä¹‰å½’çº³ï¼šå¯¹è±¡å¼æ’ä»¶

ä¸è¿‡æ€»æ˜¯`ctx.inject`æœ‰æ—¶å€™ä¼šå¯¼è‡´éš¾ä»¥é˜…è¯»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¢ç”¨å¯¹è±¡å¼æ’ä»¶ï¼š

```ts twoslash
ipe.plugin({
  inject: ['toolbox'],
  apply(ctx) {
    ctx.toolbox.addButton({
      id: 'my-first-plugin',
      icon: 'ðŸ‘‹',
      tooltip: 'My First Plugin',
      onClick: () => {
        alert('hello, world')
      },
    })
  },
})
```

çŽ°åœ¨ä½ å­¦ä¼šäº†ç¬¬äºŒç§æ’ä»¶çš„å†™æ³•ï¼š**IPE æ’ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å« `apply` æ–¹æ³•çš„å¯¹è±¡ã€‚**

- `apply` å®Œå…¨ç­‰åŒäºŽå‡½æ•°å¼æ’ä»¶ä¸­çš„å‡½æ•°

å¯é€‰çš„å±žæ€§ï¼š

- `name` å±žæ€§æ¥ä¼ é€’æ’ä»¶çš„åç§°ã€‚
- `inject` å±žæ€§æ¥ä¼ é€’æœåŠ¡åˆ—è¡¨ã€‚

## OOP çˆ±å¥½è€…ï¼šç±»å¼æ’ä»¶

**IPEçš„æ’ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå®ƒçš„ constructor çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰€åœ¨çš„ä¸Šä¸‹æ–‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯èƒ½ä¼ å…¥çš„é…ç½®é¡¹ã€‚**

```ts twoslash
import { InPageEdit } from '@inpageedit/core'

class MyButtonPlugin {
  static inject = ['toolbox']
  constructor(
    public ctx: InPageEdit,
    config?: any
  ) {
    ctx.toolbox.addButton({
      id: 'my-first-plugin',
      icon: 'ðŸ‘‹',
      tooltip: 'My First Plugin',
      onClick: () => {
        alert('hello, world')
      },
    })
  }
}

ipe.plugin(MyButtonPlugin)
```

ä¸€èˆ¬æ¥è¯´ï¼ŒTypeScript çš„çˆ±å¥½è€…ä¼šå¾ˆå–œæ¬¢è¿™ç§å†™æ³•ï¼Œå› ä¸ºå®ƒæ›´ç¬¦åˆé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¹ æƒ¯ï¼Œä½ å¯ä»¥æŠŠæ’ä»¶çš„çŠ¶æ€ä¿å­˜åœ¨ç±»çš„å®žä¾‹ä¸­ï¼Œä¹Ÿå¯ä»¥æŠŠä¸€äº›é€»è¾‘å½’çº³åœ¨ç±»çš„æ–¹æ³•ä¸­ã€‚

å¦‚æžœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œä½ ç”šè‡³å¯ä»¥ç»§æ‰¿ `BasePlugin` æ¥ç®€åŒ–ä¸€äº›æ ·æ¿ä»£ç ï¼Œæˆ–è€…ä½¿ç”¨ä¿®é¥°å™¨æ¥å£°æ˜Žä¾èµ–æ³¨å…¥ä¹‹ç±»çš„ï¼š

::: code-group

```ts twoslash [PluginMyButton.ts]
import { InPageEdit, BasePlugin, Inject } from '@inpageedit/core'
import type {} from '@inpageedit/core/dist/plugins/toolbox'

@Inject(['toolbox'])
export default class MyButtonPlugin extends BasePlugin {
  constructor(
    public ctx: InPageEdit,
    config?: any
  ) {
    super(ctx, config, 'MyButtonPlugin')
  }

  start() {
    this.ctx.toolbox.addButton({
      id: 'my-first-plugin',
      icon: 'ðŸ‘‹',
      tooltip: 'My First Plugin',
      onClick: () => {
        alert('hello, world')
      },
    })
  }

  stop() {
    this.ctx.toolbox.removeButton('my-first-plugin')
  }
}
```

```ts twoslash [index.ts]
// @filename: PluginMyButton.ts
export default class MyButtonPlugin {}

// @filename: index.ts
// ---cut---
import PluginMyButton from './PluginMyButton.js'

ipe.plugin(PluginMyButton)
```

:::

## æ€»ç»“ï¼šæ’ä»¶çš„åŸºæœ¬å½¢å¼

ä¸€ä¸ªæ’ä»¶éœ€è¦æ˜¯ä»¥ä¸‹ä¸‰ç§åŸºæœ¬å½¢å¼ä¹‹ä¸€ï¼š

1. ä¸€ä¸ªæŽ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ’ä»¶æ‰€å±žçš„ä¸Šä¸‹æ–‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯èƒ½ä¼ å…¥çš„é…ç½®é¡¹
2. ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„ `apply` æ–¹æ³•æ˜¯ç¬¬ä¸€ç§å½¢å¼ä¸­æ‰€è¯´çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å¯é€‰çš„ `inject` å’Œ `name` ç­‰å±žæ€§
3. ä¸€ä¸ªæŽ¥å—ä¸¤ä¸ªå‚æ•°çš„ç±»ï¼Œ`constructor` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ’ä»¶æ‰€å±žçš„ä¸Šä¸‹æ–‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯èƒ½ä¼ å…¥çš„é…ç½®é¡¹

```ts twoslash
import { InPageEdit } from '@inpageedit/core'
declare const ctx: InPageEdit
// ---cut---
ctx.plugin((ctx, config) => {
  // ...
})

ctx.plugin({
  inject: [],
  apply: (ctx, config) => {
    // ...
  },
})

ctx.plugin(
  class MyPlugin {
    constructor(
      public ctx: InPageEdit,
      public configs?: any
    ) {
      // ...
    }
  }
)
```
